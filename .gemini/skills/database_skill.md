# Database Skill Checklist & Best Practices (Senior Level)

데이터베이스(PostgreSQL, Redis) 관련 요청을 처리할 때 준수해야 할 **최우선 기술 지점(Source of Truth)**입니다. 본 문서는 프로젝트의 모든 데이터 스키마 설계 및 데이터 관리 원칙의 근간이 됩니다.

## 1. 데이터 무결성 및 스키마 진화 원칙 (Constitution)
- **제로 다운타임 표준 (Zero-downtime)**: 
    - 모든 스키마 변경은 서비스 중단 없이 수행되어야 합니다. 컬럼 추가 시 `DEFAULT` 값 지양, 인덱스 생성 시 `CONCURRENTLY` 사용, 2단계 배포(컬럼 추가 -> 코드 수정 -> 제약 적용)를 원칙으로 합니다.
- **데이터 원자성 및 일치성**: 
    - 복합 테이블 업데이트 시 명시적인 트랜잭션 경계를 설정하며, 외래키와 Unique 제약(`job_id` 등)을 통해 애플리케이션 레벨의 오류가 데이터 오염으로 이어지는 것을 방지합니다.

## 2. AI 데이터 플랫폼 특화 기술
- **벡터 검색(pgvector) 최적화**: 
    - 임베딩 데이터 저장 및 검색 시 목적에 맞는 거리 연산자 선택과 `HNSW` 인덱스 파라미터(`m`, `ef_construction`) 튜닝 지침을 엄격히 준수합니다.
- **하이브리드 검색(RRF) 신뢰성**: 
    - 벡터 유사도와 키워드 순위를 결합하는 `search_hybrid` 검색 로직의 무결성을 유지하며, 고성능을 위해 `to_tsvector` 기반의 Expression Index를 활용합니다.
- **중복 생성 방지 (Deduplication)**: 
    - 고비용 AI 에셋의 무분별한 생성을 막기 위해 DB 조회 기반의 자원 재활용 로직을 데이터 레이어의 필수로 고려합니다.

## 3. 동시성 제어 및 가용성 전략
- **고급 동시성 관리**: 
    - 레이스 컨디션 방지를 위해 비관적 잠금(`SELECT FOR UPDATE SKIP LOCKED`)과 낙관적 잠금(Version)을 상황에 맞게 명확히 골라 사용합니다.
- **분리된 엔진 라이프사이클**: 
    - API와 Worker의 실행 환경 차이에 따른 엔진 설정(커넥션 풀 격리)을 최우선적으로 적용하여 인프라 성능 저하를 방지합니다.
- **캐싱 및 배후 가드**: 
    - Redis 캐싱 시 '캐시 관통/사태(Avalanche)' 방지 로직(Negative Cache, Jitter TTL)을 반드시 포함합니다.

## 4. 운영 안정성 및 성능 검증
- **트랜잭션 부하 제어**: 
    - 대량 데이터 업데이트/삭제 시 반드시 Batch 방식으로 나누어 테이블 잠금 시간과 트랜잭션 로그 비대화를 방지합니다.
- **성능 가시성**: 
    - 쿼리 변경 시 `EXPLAIN ANALYZE`를 통한 부하 성능 분석을 선행하며, 데드락 방지를 위한 고정된 리소스 획득 순서를 준수합니다.
- **데이터 정제(Cleansing)**: 
    - 검색 품질 체감을 위해 Vision LLM 등으로 생성된 비정형 데이터의 토큰 노이즈 제거와 전처리를 필수 단계로 설정합니다.

## 5. 지침의 권위 및 준수
- 본 문서는 데이터베이스 설계 및 운영의 **'코드 헌법'**입니다. 
- 스키마의 물리적 변경보다 본 문서에 명시된 '데이터 상호 교류 및 보존 원칙'이 우선하며, 본 지침을 준수함으로써 상용 서비스 수준의 고가용성을 유지합니다.
